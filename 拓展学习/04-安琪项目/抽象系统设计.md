
# 数据表设计

## 抽奖按钮

功能描述：

一个九宫格，中间为抽奖按钮，周围八个格子中分别展示了不同的奖品。

这些奖品的类型和抽奖概率可由管理员设置。奖品结果由系统按照随机数生成。

部分奖品可能为上锁状态，需要达到一定积分条件才能解锁。

其中两到三个产品为奖励抽奖积分，积分值可以手动设置。


----
好的，我来帮你把这个抽奖功能描述进行企业级标准的补充，并设计一套数据表结构（考虑扩展性、可维护性、日志追踪、审计功能）。

⸻

功能描述（补充完善版）

1. 基础功能
	•	页面为九宫格抽奖盘：
	•	中间格子为抽奖按钮
	•	周围 8 个格子展示奖品
	•	点击抽奖按钮后，系统根据配置的 奖品池及概率，结合随机数算法，计算并返回用户抽中的奖品。

2. 奖品配置
	•	奖品类型包括但不限于：
	•	实物奖品
	•	虚拟卡券（优惠券、兑换码等）
	•	抽奖积分（再次参与抽奖的消耗或奖励）
	•	空奖（谢谢参与）
	•	每个奖品可设置：
	•	概率（支持百分比或权重配置）
	•	数量上限（库存，避免无限发放）
	•	有效期（仅在有效期内生效）
	•	是否为锁定奖品

3. 积分机制
	•	用户拥有抽奖积分，积分用于参与抽奖和解锁部分奖品。
	•	奖品中可能包含积分奖励，积分值可由管理员配置。
	•	部分奖品设为 解锁条件：用户积分 ≥ 指定值后才可抽中该奖品。

4. 抽奖规则
	•	单次抽奖需消耗固定或可变数量的积分（由管理员设置）。
	•	奖品分配算法：
	1.	过滤掉未解锁或已过期的奖品
	2.	按照剩余奖品的概率权重进行随机数生成
	3.	判断库存是否足够，否则按兜底逻辑（如转为“谢谢参与”）

5. 管理员功能
	•	奖品管理（增删改查、概率调整、锁定配置、库存设置）
	•	活动管理（不同时间段可配置不同奖池）
	•	抽奖日志查询与导出
	•	用户积分管理（调整、清零、奖励、冻结）

6. 日志与审计
	•	每一次抽奖需记录日志：用户ID、奖品ID、时间、积分消耗、积分变动、系统随机数结果、状态（成功/失败）。
	•	管理员的奖品配置操作也需要审计日志。

⸻

数据表设计（符合企业级标准）

1. 用户与积分

user
	•	user_id (PK)
	•	username
	•	phone/email
	•	status (active/frozen)
	•	created_at
	•	updated_at

user_points
	•	id (PK)
	•	user_id (FK)
	•	points_balance (当前积分)
	•	updated_at

user_points_log （积分流水）
	•	id (PK)
	•	user_id (FK)
	•	change_type (earn/spend/adjust)
	•	change_amount (+/-)
	•	source (e.g. “抽奖消耗”, “奖励获取”, “管理员调整”)
	•	related_draw_id (FK，可空)
	•	created_at

⸻

2. 抽奖配置

lottery_activity （抽奖活动，支持多个活动）
	•	activity_id (PK)
	•	name
	•	description
	•	status (active/inactive)
	•	start_time
	•	end_time
	•	cost_points (单次抽奖消耗积分)
	•	created_at
	•	updated_at

lottery_prize （奖品表）
	•	prize_id (PK)
	•	activity_id (FK)
	•	prize_name
	•	prize_type (physical/virtual/points/none)
	•	prize_value (如积分数值、优惠券ID等)
	•	probability_weight (用于计算概率)
	•	stock_total (总库存，-1 表示无限)
	•	stock_remain (剩余库存)
	•	is_locked (bool)
	•	unlock_points (需要的积分条件)
	•	valid_from
	•	valid_to
	•	created_at
	•	updated_at

⸻

3. 抽奖日志

lottery_draw_log
	•	draw_id (PK)
	•	user_id (FK)
	•	activity_id (FK)
	•	prize_id (FK，可空，若为“谢谢参与”则空)
	•	random_number (用于审计)
	•	points_spent
	•	points_earned
	•	status (success/fail)
	•	created_at

⸻

4. 管理员与审计

admin_user
	•	admin_id (PK)
	•	username
	•	role (super_admin/operator)
	•	status
	•	created_at

admin_action_log
	•	id (PK)
	•	admin_id (FK)
	•	action_type (add_prize/update_probability/adjust_points…)
	•	target_id (相关 prize_id/activity_id/user_id)
	•	detail (JSON，保存修改前后内容)
	•	created_at

⸻

设计特点
	1.	高扩展性：一个活动可配置多个奖池，支持多类型奖品。
	2.	高安全性：日志与审计防止作弊或误操作。
	3.	高可维护性：积分、奖品、活动解耦，方便单独调整。
	4.	可审计性：存储随机数结果与操作日志，便于合规检查。

⸻

要不要我帮你画一张 数据表ER图（实体关系图），把这些表之间的关系直观地展示出来？