##  背景
- 召回团队实现了一种GNN召回通道，离线实验结果正向。
- 做线上的小流量A/B测试，考察新的召回通道对线上指标的影响。
- 模型中含有一些参数，如GNN的深度取值$\in\{1,2,3\}$需要用A/B测试选取最优参数。
	- 可以同时开多组A/B测试

## 随机分桶

若用户数量足够大，则每个桶中用户的点击两、D AU、 留存都是些相等的。
![[随机分桶-1.png]]

![[随机分桶-2.png]]
- 实验组1~3用不同深度的GNN
-  推全：用户流量扩大至100%

## 分层实验

目标：解决流量不够用问题

  问题场景：![[分层实验-1.png]]
如果把用户随机分为十组，1组为对照，9组为实验，那只能同时做九组实验。

- **分层实验**：召回、粗排、精排、重排、用户界面、广告……
  > GNN召回通道就属于召回层
- **同层互斥**：GNN实验占4个桶，那其他召回实验只能用剩余六个桶
- **不同层**间正交：每层独立随机对用户做分桶，每层都可以独立使用100%的用户做实验。
>[!note]
>Tang, Diane, et al. "Overlapping experiment infrastructure: More, better, faster experimentation." _Proceedings of the 16th ACM SIGKDD international conference on Knowledge discovery and data mining_. 2010.

## 分层实验——不同层正交
 ![[分层实验-不同层正交.png]]
![[分层实验-不同层正交-2.png]]

## 互斥vs正交

![[同层互斥.png]]

![[不同层正交.png]]

- 为什么不全部用正交？
	- 有的策略天然互斥。
	- 同类策略效果可能回相互增强或者相互抵消。互斥可以避免同类策略相互干扰。
	- 不同策略通常不会相互干扰，可以作为正交的两层

## Holdout机制

- 每个实验独立汇报业务指标的提升
- 公司考察一个部门在一段时间内的业务指标总提升
- 取10%的用户作为holdout桶，推荐系统取剩下90%做实验，两者互斥
- 计算两组的diff（需要归一化），为整个部门业务指标
![[holdhout.png]]

- 考核期结束后，清楚holdout桶，让推全实验从90%扩大到100%
- 然后随机划分用户，设计新的holdout和对照，进行下一次考核
- 新的holdout与对照的各业务指标diff接近于0
- 随着各项实验上线和推全，diff会逐渐增大

## 实验推全和反转实验
 